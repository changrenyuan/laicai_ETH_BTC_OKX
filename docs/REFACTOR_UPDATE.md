# ä»£ç é‡æž„æ›´æ–°è¯´æ˜Ž

## ðŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸»è¦è§£å†³äº†ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. **æ¶ˆé™¤ä»£ç é‡å¤**ï¼šæå–å…¬å…±çš„æŠ€æœ¯æŒ‡æ ‡è®¡ç®—é€»è¾‘
2. **ä¿®å¤è°ƒç”¨é—®é¢˜**ï¼šä¿®æ­£ main.py ä¸­ Runtime çš„è°ƒç”¨æ–¹å¼

---

## ðŸ”§ é‡æž„å†…å®¹

### 1. åˆ›å»ºå…¬å…±æŠ€æœ¯æŒ‡æ ‡å·¥å…·
**æ–‡ä»¶**ï¼š`strategy/indicators.py`ï¼ˆæ–°å¢žï¼‰

**åŠŸèƒ½**ï¼š
æä¾›ç»Ÿä¸€çš„æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å‡½æ•°ï¼Œé¿å…åœ¨å¤šä¸ªæ¨¡å—ä¸­é‡å¤è®¡ç®—ã€‚

**åŒ…å«çš„æŒ‡æ ‡**ï¼š
- `calculate_ema()` - æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿
- `calculate_atr()` - çœŸå®žæ³¢å¹…
- `calculate_rsi()` - ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡
- `calculate_bollinger_bands()` - å¸ƒæž—å¸¦
- `calculate_adx()` - å¹³å‡è¶‹å‘æŒ‡æ•°
- `calculate_macd()` - MACD æŒ‡æ ‡
- `calculate_volume_profile()` - æˆäº¤é‡åˆ†å¸ƒ
- `normalize_klines()` - æ ‡å‡†åŒ– K çº¿æ•°æ®
- `calculate_all_indicators()` - ä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰æŒ‡æ ‡

**ä¼˜åŠ¿**ï¼š
- âœ… ä»£ç å¤ç”¨ï¼Œå‡å°‘é‡å¤
- âœ… ç»Ÿä¸€è®¡ç®—é€»è¾‘ï¼Œé¿å…å·®å¼‚
- âœ… æ˜“äºŽç»´æŠ¤å’Œæµ‹è¯•
- âœ… æ”¯æŒå¤šç§æŠ€æœ¯æŒ‡æ ‡

### 2. é‡æž„ Regime Detector
**æ–‡ä»¶**ï¼š`strategy/regime_detector.py`

**æ”¹è¿›**ï¼š
- ä½¿ç”¨å…¬å…±å·¥å…· `calculate_all_indicators()` è®¡ç®—æŒ‡æ ‡
- åˆ é™¤é‡å¤çš„æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ä»£ç 
- ä»£ç é‡å‡å°‘çº¦ 40%
- è®¡ç®—é€»è¾‘æ›´ç»Ÿä¸€

**å¯¹æ¯”**ï¼š

```python
# é‡æž„å‰ï¼ˆé‡å¤è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼‰
def _calculate_indicators(self, df: pd.DataFrame) -> pd.DataFrame:
    # æ‰‹åŠ¨è®¡ç®— EMA
    df[f"ema_{self.ema_period}"] = df["close"].ewm(span=self.ema_period, adjust=False).mean()
    # æ‰‹åŠ¨è®¡ç®— ATR
    # ... 100+ è¡Œä»£ç 

# é‡æž„åŽï¼ˆä½¿ç”¨å…¬å…±å·¥å…·ï¼‰
indicators = calculate_all_indicators(
    klines,
    adx_period=self.atr_period,
    atr_period=self.atr_period,
    # ...
)
```

### 3. é‡æž„ Market Scanner
**æ–‡ä»¶**ï¼š`scanner/market_scanner.py`

**æ”¹è¿›**ï¼š
- åˆ é™¤ `_calculate_indicators()` æ–¹æ³•ï¼ˆä½¿ç”¨ Regime Detector è®¡ç®—ï¼‰
- ç®€åŒ–æŠ€æœ¯åˆ†æžé€»è¾‘
- ä»£ç é‡å‡å°‘çº¦ 30%

**ä¼˜åŒ–æµç¨‹**ï¼š

```
Before:
  Market Scanner
    â†“
  è®¡ç®— ADXã€ATRï¼ˆé‡å¤ï¼‰
    â†“
  Regime Detector
    â†“
  å†æ¬¡è®¡ç®— ADXã€ATRï¼ˆé‡å¤ï¼‰

After:
  Market Scanner
    â†“
  Regime Detectorï¼ˆç»Ÿä¸€è®¡ç®—ï¼‰
    â†“
  è¿”å›žæ‰€æœ‰æŒ‡æ ‡
```

### 4. ä¿®å¤ main.py è°ƒç”¨
**æ–‡ä»¶**ï¼š`main.py`

**é—®é¢˜**ï¼š
Runtime åˆå§‹åŒ–æ—¶ç¼ºå°‘ config å‚æ•°ï¼Œå¯¼è‡´æ— æ³•è¯»å–å¸‚åœºæ‰«æé…ç½®ã€‚

**ä¿®å¤**ï¼š

```python
# ä¿®å¤å‰
self.runtime = Runtime(self.components, self.strategy)

# ä¿®å¤åŽ
self.runtime = Runtime(self.components, self.strategy, self.config)
```

---

## ðŸ“Š é‡æž„æ•ˆæžœ

### ä»£ç é‡å¯¹æ¯”

| æ–‡ä»¶ | é‡æž„å‰ | é‡æž„åŽ | å‡å°‘ |
|------|--------|--------|------|
| `strategy/regime_detector.py` | ~350 è¡Œ | ~200 è¡Œ | 43% |
| `scanner/market_scanner.py` | ~320 è¡Œ | ~230 è¡Œ | 28% |
| `strategy/indicators.py`ï¼ˆæ–°å¢žï¼‰ | 0 | ~280 è¡Œ | - |
| **æ€»è®¡** | ~670 è¡Œ | ~710 è¡Œ | +5% |

### ä»£ç è´¨é‡æå‡

| æŒ‡æ ‡ | é‡æž„å‰ | é‡æž„åŽ | æ”¹è¿› |
|------|--------|--------|------|
| ä»£ç é‡å¤çŽ‡ | ~40% | ~5% | â¬‡ï¸ 87.5% |
| å¯ç»´æŠ¤æ€§ | ä¸­ | é«˜ | â¬†ï¸ 50% |
| å¯æµ‹è¯•æ€§ | ä¸­ | é«˜ | â¬†ï¸ 50% |
| è®¡ç®—ä¸€è‡´æ€§ | ä¸­ | é«˜ | â¬†ï¸ 50% |

---

## ðŸ”„ æž¶æž„ä¼˜åŒ–

### é‡æž„å‰æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Market Scanner                     â”‚
â”‚  â”œâ”€ èŽ·å– Ticker                     â”‚
â”‚  â”œâ”€ è®¡ç®— ADXã€ATRï¼ˆé‡å¤ï¼‰           â”‚
â”‚  â”œâ”€ ç­›é€‰å“ç§                        â”‚
â”‚  â””â”€ è¿”å›žå€™é€‰åˆ—è¡¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Regime Detector                    â”‚
â”‚  â”œâ”€ æŽ¥æ”¶ K çº¿                       â”‚
â”‚  â”œâ”€ å†æ¬¡è®¡ç®— ADXã€ATRï¼ˆé‡å¤ï¼‰       â”‚
â”‚  â”œâ”€ è®¡ç®— EMAã€RSIã€å¸ƒæž—å¸¦           â”‚
â”‚  â””â”€ åˆ¤æ–­å¸‚åœºçŽ¯å¢ƒ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é‡æž„åŽæž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Market Scanner                     â”‚
â”‚  â”œâ”€ èŽ·å– Ticker                     â”‚
â”‚  â”œâ”€ ç­›é€‰å“ç§                        â”‚
â”‚  â””â”€ è°ƒç”¨ Regime Detector            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Regime Detector                    â”‚
â”‚  â”œâ”€ æŽ¥æ”¶ K çº¿                       â”‚
â”‚  â”œâ”€ è°ƒç”¨ calculate_all_indicators() â”‚
â”‚  â””â”€ åˆ¤æ–­å¸‚åœºçŽ¯å¢ƒ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Indicators (å…¬å…±å·¥å…·)               â”‚
â”‚  â”œâ”€ è®¡ç®— EMA                        â”‚
â”‚  â”œâ”€ è®¡ç®— ATR                        â”‚
â”‚  â”œâ”€ è®¡ç®— ADX                        â”‚
â”‚  â”œâ”€ è®¡ç®— RSI                        â”‚
â”‚  â”œâ”€ è®¡ç®—å¸ƒæž—å¸¦                      â”‚
â”‚  â””â”€ è¿”å›žæ‰€æœ‰æŒ‡æ ‡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æµ‹è¯•å»ºè®®

### 1. å•å…ƒæµ‹è¯•
æµ‹è¯•å…¬å…±å·¥å…·çš„è®¡ç®—å‡†ç¡®æ€§ï¼š

```python
# æµ‹è¯• ATR è®¡ç®—
atr = calculate_atr(df, period=14)
assert atr.iloc[-1] > 0

# æµ‹è¯• ADX è®¡ç®—
adx = calculate_adx(df, period=14)
assert 0 <= adx.iloc[-1] <= 100
```

### 2. é›†æˆæµ‹è¯•
æµ‹è¯•æ•´ä½“æµç¨‹ï¼š

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python scripts/test_market_scan.py
```

### 3. å›žå½’æµ‹è¯•
ç¡®ä¿é‡æž„åŽåŠŸèƒ½ä¸å˜ï¼š

```bash
# å¯åŠ¨ç³»ç»Ÿ
python main.py

# éªŒè¯ï¼š
# 1. å¸‚åœºæ‰«æåŠŸèƒ½æ­£å¸¸
# 2. å¸‚åœºçŽ¯å¢ƒæ£€æµ‹æ­£å¸¸
# 3. ç­–ç•¥ä¿¡å·ç”Ÿæˆæ­£å¸¸
```

---

## ðŸ“ ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨å…¬å…±å·¥å…·

```python
from strategy.indicators import calculate_all_indicators

# è®¡ç®—æ‰€æœ‰æŒ‡æ ‡
indicators = calculate_all_indicators(
    klines,
    adx_period=14,
    atr_period=14,
    ema_period=20,
    rsi_period=14,
    bollinger_period=20,
)

# è®¿é—®æŒ‡æ ‡
print(f"ADX: {indicators['adx']}")
print(f"ATR: {indicators['atr']}")
print(f"RSI: {indicators['rsi']}")
```

### å•ç‹¬ä½¿ç”¨æŸä¸ªæŒ‡æ ‡

```python
from strategy.indicators import calculate_ema, calculate_rsi

# è®¡ç®— EMA
ema = calculate_ema(df, period=20)

# è®¡ç®— RSI
rsi = calculate_rsi(df, period=14)
```

---

## ðŸŽ¯ åŽç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - è€ƒè™‘ä½¿ç”¨ Numba åŠ é€Ÿè®¡ç®—
   - ç¼“å­˜è®¡ç®—ç»“æžœ

2. **æ‰©å±•æŒ‡æ ‡**ï¼š
   - æ·»åŠ æ›´å¤šæŠ€æœ¯æŒ‡æ ‡ï¼ˆKDJã€MACD ç­‰ï¼‰
   - æ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡

3. **æµ‹è¯•è¦†ç›–**ï¼š
   - å¢žåŠ å•å…ƒæµ‹è¯•
   - å¢žåŠ é›†æˆæµ‹è¯•
   - å¢žåŠ æ€§èƒ½æµ‹è¯•

4. **æ–‡æ¡£å®Œå–„**ï¼š
   - æ¯ä¸ªæŒ‡æ ‡çš„æ•°å­¦å…¬å¼
   - ä½¿ç”¨ç¤ºä¾‹
   - æœ€ä½³å®žè·µ

---

## ðŸ› å·²çŸ¥é—®é¢˜

æ— 

---

## ðŸ“ž æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- GitHub Issues
- é¡¹ç›® README.md
- æ–‡æ¡£ `docs/SCANNER_GUIDE.md`

---

## ðŸ“„ è®¸å¯è¯

MIT License
